================================================================================
MEOWDISH 넷코드 마이그레이션 - 빠른 시작 가이드
================================================================================

다음 순서대로 파일을 읽으세요:
1. 넷코드_분석_README.md (5분) - 개요 및 인덱스
2. 넷코드_분석_요약.md (15분) - 요약본
3. 넷코드_상세분석.md (1시간) - 문제점 심층 분석
4. 넷코드_구현_템플릿.md (1시간) - 코드 템플릿

================================================================================
이해해야 할 3가지 크리티컬 이슈:
================================================================================

이슈 #1: 아이템 ID 동기화 실패 (ContainerSystem.cs 89번 라인)
  현재: private int _nextItemID = 1;
  문제: 각 클라이언트마다 다름 = 네트워크 동기화 실패
  해결: 서버가 ID 생성, 클라이언트에 브로드캐스트

이슈 #2: 입력 처리 (PlayerInputSystem.cs 46-83번 라인)
  현재: Input.GetKey() → PlayerInputComponent → 모든 곳에 적용
  문제: "내 입력"과 "다른 플레이어" 구분 불가
  해결: LocalInputGatherSystem + NetworkOwner 체크

이슈 #3: GAMEOBJECT 비주얼 (ItemVisualSystem.cs 17-88번 라인)
  현재: ECS 시스템에서 GameObject.CreatePrimitive() 사용
  문제: GameObject는 네트워크로 복제 불가능
  해결: 순수 ECS 렌더링을 위한 Graphics.DrawMesh()

================================================================================
마이그레이션 타임라인:
================================================================================

1주차 (15시간)    → 기초: NetworkOwner/NetworkEntity 생성
2-3주차 (20시간)  → 입력/이동: 플레이어 시스템 리팩토링
3-4주차 (20시간)  → 크리티컬: 서버 ID가 있는 아이템 시스템
4-5주차 (24시간)  → 렌더링: 순수 ECS 그래픽
5-6주차 (24시간)  → 상호작용: 서버 권한
6-7주차 (30시간)  → 테스트: 유닛 테스트, 통합 테스트

전체: 153시간 (1명 개발자 기준 6-8주)

================================================================================
구현 체크리스트 (Phase 1):
================================================================================

1주차 - 기초 단계:

[ ] 넷코드_분석_README.md 읽기
[ ] 넷코드_분석_요약.md 읽기
[ ] 넷코드_아키텍처_비교.md 검토
[ ] 새 파일 생성: Assets/Scripts/ECS/Components/Network/NetworkOwner.cs
    └─ 넷코드_구현_템플릿.md에서 복사
[ ] 새 파일 생성: Assets/Scripts/ECS/Components/Network/NetworkEntity.cs
    └─ 넷코드_구현_템플릿.md에서 복사
[ ] 새 파일 생성: Assets/Scripts/ECS/Components/Network/LocalPlayerTag.cs
[ ] PlayerAuthoring.cs 업데이트 - NetworkOwner 컴포넌트 추가
[ ] 테스트: 싱글플레이어로 게임 실행, 여전히 작동하는지 확인
[ ] git 브랜치 생성: feature/netcode-foundation
[ ] 커밋 메시지: "Phase 1: Network foundation components"

그 다음 PHASE 2로 이동:

[ ] 읽기: 넷코드_상세분석.md의 "PlayerMovementSystem" 섹션
[ ] 읽기: 넷코드_구현_템플릿.md "PlayerMovementSystem → Add Owner Check"
[ ] PlayerMovementSystem.cs 업데이트:
    └─ RequireForUpdate에 NetworkOwner 추가
    └─ Query에 NetworkOwner 추가
    └─ 이동 시스템이 여전히 작동하는지 테스트
[ ] 새로 생성: LocalInputGatherSystem.cs
    └─ 넷코드_구현_템플릿.md에서 템플릿 복사
[ ] PlayerInputSystem.cs 업데이트 (범위 축소)
[ ] 테스트: 로컬 플레이어의 입력 수집이 작동하는지
[ ] 커밋: "Phase 2: Owner-only movement and input separation"

그 다음 PHASE 3로 이동 (크리티컬):

[ ] 생성: ServerItemAuthority.cs (서버 전용)
[ ] 생성: ClientItemSync.cs (클라이언트 전용)
[ ] 생성: TakeItemRequestRpc struct
[ ] 생성: ItemCreatedEvent struct
[ ] 리팩토링: ContainerSystem.cs - 아이템 생성 제거
[ ] 테스트: 클라이언트들 간 아이템 생성 동기화
[ ] 커밋: "Phase 3: Server-authoritative item system"

================================================================================
수정할 주요 파일들:
================================================================================

주요 시스템 (순서대로):
1. /Assets/Scripts/ECS/Systems/Player/PlayerMovementSystem.cs (12시간)
2. /Assets/Scripts/ECS/Systems/Player/PlayerInputSystem.cs (20시간)
3. /Assets/Scripts/ECS/Systems/Interaction/ContainerSystem.cs (20시간)
4. /Assets/Scripts/ECS/Systems/Interaction/InteractionSystem.cs (24시간)
5. /Assets/Scripts/ECS/Systems/Visual/ItemVisualSystem.cs (24시간)

보조 오쏘링:
- /Assets/Scripts/ECS/Authoring/PlayerAuthoring.cs

생성할 새 파일들:
- Network 컴포넌트 디렉토리
- Authority 시스템 (서버 전용)
- Sync 시스템 (클라이언트 전용)
- RPC 커맨드 정의
- 이벤트 구조체

================================================================================
테스트 요구사항:
================================================================================

각 Phase 후:
✓ 싱글플레이어가 여전히 작동함
✓ 컴파일 에러 없음
✓ NetCode 관련 에러 없음
✓ Git 클린 커밋

Phase 3 검증 (크리티컬):
✓ 2개의 로컬 클라이언트 생성
✓ 플레이어 A가 아이템 획득 → 모든 클라이언트가 ID=X 확인
✓ 플레이어 B가 아이템 획득 → 모든 클라이언트가 ID=X+1 확인
✓ 아이템이 동기화 실패하지 않음

최종 통합:
✓ 완전한 2-클라이언트 + 서버 테스트
✓ 예측/롤백 작동
✓ 고스트 플레이어 글리치 없음
✓ 성능 허용 가능

================================================================================
문서 참조:
================================================================================

모든 질문에 대한 답변:

개념적:         → 넷코드_분석_요약.md
아키텍처:       → 넷코드_아키텍처_비교.md
기술적 심층:     → 넷코드_상세분석.md
코드 예제:      → 넷코드_구현_템플릿.md

모든 문서는 다음을 포함:
- 이슈 설명 (무엇이 잘못되었는가)
- 문제인 이유 (NetCode 비호환성)
- 상세한 해결책 (어떻게 고칠 것인가)
- 라인 번호 (어디에 구현할 것인가)
- 코드 예제 (복사-붙여넣기 준비됨)

================================================================================
흔한 실수들:
================================================================================

1. 엔티티 참조가 동기화되지 않음
   - 문제: CurrentStationEntity가 로컬 Entity ID 참조
   - 해결: 대신 NetworkEntity.NetworkID 사용
   - 참조: 넷코드_상세분석.md "Component Analysis"

2. 입력 기반 애니메이션이 고스트 플레이어에서 깨짐
   - 문제: 고스트는 "진짜" 입력이 없어서 애니메이션 표시 안됨
   - 해결: 입력이 아닌 이동 델타 기반 애니메이션
   - 참조: 넷코드_상세분석.md "PlayerAnimationSystem"

3. GameObject.Find()가 문제를 일으킴
   - 문제: 느리고 신뢰성 없음, 네트워크 컨텍스트에서 작동 안함
   - 해결: 의존성 주입 또는 캐싱된 FindObjectOfType 사용
   - 참조: 넷코드_구현_템플릿.md "Issue 1"

4. Burst 컴파일 요구사항
   - 문제: 시스템이 NetCode를 위해 BurstCompile 호환이어야 함
   - 해결: SystemBase 클래스가 아닌 ISystem struct 사용
   - 참조: 넷코드_상세분석.md "PlayerInputSystem"

5. 아이템 ID 생성
   - 문제: 각 클라이언트가 독립적으로 카운터 증가
   - 해결: 서버가 ID 생성, 모두에게 브로드캐스트
   - 참조: 넷코드_상세분석.md "ContainerSystem" (크리티컬)

================================================================================
성공 지표:
================================================================================

Phase 1 완료:  네트워크 컴포넌트 존재, 싱글플레이어 작동
Phase 2 완료:  이동이 소유자 전용, 입력 분리됨
Phase 3 완료:  아이템 ID가 모든 클라이언트에 동기화됨
Phase 4 완료:  순수 ECS 렌더링, GameObject 없음
Phase 5 완료:  상호작용이 서버 권한
Phase 6 완료:  모든 테스트 통과, 2+ 플레이어가 함께 플레이 가능

================================================================================
리소스:
================================================================================

Unity NetCode 문서:
  https://docs.unity.com/netcode/current/content/getting-started.html

DOTS ECS 문서:
  https://docs.unity3d.com/Packages/com.unity.entities/current

Burst 컴파일:
  https://docs.unity3d.com/Packages/com.unity.burst/current

필요한 모든 정보는 5개의 분석 문서에 있습니다.
외부 학습 불필요 - 템플릿 제공됨.

================================================================================

질문이 있나요? 상세 분석 문서를 확인하세요.
시작할 준비 되었나요? Phase 1 기초 작업(1주차)부터 시작하세요.

멀티플레이어 구현에 행운을 빕니다!

